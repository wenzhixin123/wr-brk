<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
		"-//Hibernate/Hibernate Mapping DTD 3.0//EN"
		"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping>
	<sql-query name="YclCheckHasPickQuery">
		<![CDATA[

SELECT RS.IN_LOGISTICS_ORDER_DETAIL_UUID AS RS_IN_LOD_UUID,
       LOD.LOGISTICS_ORDER_DETAIL_UUID AS OUT_LOD_UUID,
       LT.QTY,
       LOD.QTY AS LOD_QTY,
       IFNULL((LOD.QTY - LOD.CONFIRMED_QTY), 0) AS CAN_PICK_QTY,
       IFNULL((LOD.QTY - LOD.DELIVERED_QTY), 0) AS CAN_OUT_QTY,
       LOD.DELIVERED_QTY,
       LOD.CONFIRMED_QTY,
       LT.LOC_TASK_DATE,
       LT.LOC_TASK_TYPE,
       LT.LOC_TASK_DESC,
       LT.LOCATION_TASK_UUID,
       LT.LOGISTICS_ORDER_DETAIL_UUID,
       LT.IN_LOGISTICS_ORDER_DETAIL_UUID,
       LT.IN_STOCK_WORK_UUID,
       RS.REMAIN_SINWORK_UUID,
       RS.IN_STOCK_WORK_UUID AS RS_IN_STOCK_WORK_UUID,
       RS.REMAIN_QTY,
       RS.LOT_CODE,
       RS.BARCODE AS RS_BARCODE,
       LT.LOC_TASK_NO,
       RS.BATCH_NO,
       RS.ITEM_CODE,
       RS.ITEM_SEQNO,
       RS.EXT_ITEM_CODE,
       RS.GOODS_DESC,
       RS.MARKS_NUMBER,
       LT.MODEL,
       LT.SPEC,
       LT.LENGTH_UNIT_CODE,
       LT.LENGTH_UNIT_DESC,
       RS.LENGTH,
       RS.WIDTH,
       RS.HEIGHT,
       RS.INSTOCK_UNIT_CODE AS UNIT_CODE,
       RS.INSTOCK_UNIT_DESC AS UNIT_DESC,
       RS.REMAIN_SECOND_QTY AS SECOND_QTY,
	   RS.INSTOCK_SECOND_UNIT_CODE AS SECOND_UNIT_CODE,
       RS.INSTOCK_SECOND_UNIT_DESC AS SECOND_UNIT_DESC,
       RS.INSTOCK_THIRD_UNIT_CODE AS THIRD_UNIT_CODE,
       RS.INSTOCK_THIRD_UNIT_DESC AS THIRD_UNIT_DESC,
       RS.REMAIN_THIRD_QTY AS THIRD_QTY,
       LT.WEIGHT_UNIT_CODE,
       LT.WEIGHT_UNIT_DESC,
       RS.REMAIN_GROSS_WEIGHT AS GROSS_WEIGHT,
       LT.VOLUME_UNIT_CODE,
       LT.VOLUME_UNIT_DESC,
       RS.REMAIN_NET_WEIGHT AS NET_WEIGHT,
       RS.REMAIN_VOLUME AS VOLUME,
       LT.LAST_LOCATION_TASK_UUID,
       LT.STATUS,
       RS.GOODS_KIND,
       RS.GOODS_NATURE,
       LT.DANGER_CODE,
       RS.PACKAGE_NO,
       LT.PACKAGE_TYPE,
       LT.SOURCE_LOT_CODE,
       LT.TARGET_LOT_CODE,
       LT.BARCODE,
       RS.PANEL_NO,
       LT.WRH_WORKER,
       LT.WRH_CUST,
       LT.REMARK,
       LT.AUX1,
       LT.AUX2,
       LT.AUX3,
       LT.AUX4,
       LT.AUX5,
       LT.OFFICE_CODE,
       LT.REC_VER,
       LT.CREATOR,
       LT.MODIFIER,
       LT.MODIFY_TIME,
       LT.OTHER_PK_UUID,
       RS.PRODUCTION_DATE,
       LOD.PRODUCTION_DATE AS LOD_PRODUCTION_DATE, 
       RS.CREATE_TIME,
       LOD.CONTROL_WORD,
       LOD.LOGISTICS_ORDER_UUID,
       LOD.TRANSACTION_TYPE,
       LOD.SUBMIT_ORDER_DETAIL_UUID
  FROM LOGISTICS_ORDER_DETAIL LOD,
       LOGISTICS_ORDER        LO,
       LOCATION_TASK          LT,
       STOCK_WORK             SW,
       REMAIN_SINWORK         RS
 WHERE LT.LOCATION_TASK_UUID = SW.LOCATION_TASK_UUID
   AND SW.STOCK_WORK_UUID = RS.IN_STOCK_WORK_UUID
   AND LOD.LOGISTICS_ORDER_UUID=LO.LOGISTICS_ORDER_UUID
   AND LOD.OFFICE_CODE = RS.OFFICE_CODE
   AND LOD.TRANSACTION_STATUS = :status
   AND LOD.OFFICE_CODE = :officeCode
   <<AND LOD.LOGISTICS_ORDER_NO = :logisticsOrderNo>>
   <<AND RS.BARCODE = :barcode>>
   <<AND (RS.BARCODE = :barcodeOrPanelNo OR RS.PANEL_NO = :barcodeOrPanelNo)>>
   <<AND (RS.BARCODE = :barcodeOrPackageNo OR RS.PACKAGE_NO = :barcodeOrPackageNo)>>
   <<AND RS.PANEL_NO = :panelNo>>
   <<AND RS.PACKAGE_NO = :packageNo>>
   <<AND LT.LOC_TASK_TYPE = :locTaskType>>
   <<AND LT.LOC_TASK_TYPE <> :pickLocTaskType>>
   <<AND LOD.LOGISTICS_ORDER_DETAIL_UUID IN ( SELECT DISTINCT LPD.LOGISTICS_ORDER_DETAIL_UUID FROM LOC_PLAN LP, LOC_PLAN_DETAIL LPD WHERE LPD.LOC_PLAN_UUID = LP.LOC_PLAN_UUID AND LP.OFFICE_CODE = RS.OFFICE_CODE AND LP.LOC_PLAN_NO = :locPlanNo AND LP.STATUS = LOD.TRANSACTION_STATUS )>>
   <<AND NVL(LT.QTY, 0) - (SELECT IFNULL(SUM(NVL(LTT.QTY, 0)), 0) FROM LOCATION_TASK LTT WHERE LTT.LAST_LOCATION_TASK_UUID = LT.LOCATION_TASK_UUID AND LTT.OFFICE_CODE = LT.OFFICE_CODE AND LTT.LOC_TASK_TYPE =:locTaskCancelType) > 0>>
   <<AND LOD.LOGISTICS_ORDER_DETAIL_UUID IN (:lodUuids)>>
   <<AND RS.REMAIN_SINWORK_UUID = :remainSinworkUuid>>
   AND LT.OFFICE_CODE = :officeCode
   AND RS.OFFICE_CODE = :officeCode
   AND ##CONDITIONS##

		]]>
	</sql-query>
</hibernate-mapping>
