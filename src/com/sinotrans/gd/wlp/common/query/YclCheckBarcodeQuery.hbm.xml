<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
		"-//Hibernate/Hibernate Mapping DTD 3.0//EN"
		"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping>
	<sql-query name="YclCheckBarcodeQuery">
		<![CDATA[

SELECT LO.CARGO_CONSIGNEE_DESC,
       LO.AGENT_CONSIGNEE_CODE,
       LO.DELIVERY_TYPE,
       LO.ORDER_NO,
       LOD.LOGISTICS_ORDER_DETAIL_UUID,
       LOD.LOGISTICS_ORDER_UUID,
       LOD.LOGISTICS_ORDER_NO,
       LOD.SEQ_NO,
       LOD.BILL_NO,
       LOD.ITEM_CODE,
       LOD.ITEM_SEQNO,
       LOD.EXT_ITEM_CODE,
       LOD.GOODS_DESC,
       LOD.MARKS_NUMBER,
       LOD.QTY,
       LOD.QTY_UNIT_CODE,
       LOD.QTY_UNIT_DESC,
       LOD.SECOND_QTY,
       LOD.SECOND_UNIT_CODE,
       LOD.SECOND_UNIT_DESC,
       LOD.THIRD_QTY,
       LOD.THIRD_UNIT_CODE,
       LOD.THIRD_UNIT_DESC,
       LOD.VOLUME_UNIT_CODE,
       LOD.VOLUME_UNIT_DESC,
       LOD.CURRENCY_CODE,
       LOD.CURRENCY_DESC,
       LOD.DANGER_CODE,
       LOD.DELIVERED_QTY,
       LOD.CONFIRMED_QTY,
       LOD.GOODS_KIND,
       LOD.GOODS_NATURE,
       LOD.PACKAGE_NO,
       LOD.PACKAGE_TYPE,
       LOD.BOM_CODE,
       LOD.BARCODE AS LOD_BARCODE,
       LOD.CONTROL_WORD,
       LOD.IN_LOGISTICS_ORDER_DETAIL_UUID,
       LOD.IN_LOGISTICS_ORDER_NO,
       LOD.REMAIN_HOLD_UUID,
       LOD.SOURCE_LOT_CODE,
       LOD.TARGET_LOT_CODE,
       LOD.TRANSACTION_STATUS,
       LOD.TRANSACTION_TYPE,
       LOD.REMARK,
       LOD.AUX1,
       LOD.AUX2,
       LOD.AUX3,
       LOD.AUX4,
       LOD.AUX5,
       LOD.SUBMIT_ORDER_DETAIL_UUID,
       B.BATCH_NO,      
       B.MODEL,
       B.SPEC,
       B.LENGTH_UNIT_CODE,
       B.LENGTH_UNIT_DESC,
       B.LENGTH,
       B.WIDTH,
       B.HEIGHT,
       B.GROSS_WEIGHT,
       B.WEIGHT_UNIT_CODE,
       B.WEIGHT_UNIT_DESC,
       B.NET_WEIGHT,
       B.VOLUME,
       B.UNIT_PRICE,
       B.TOTAL_PRICE,
       B.OFFICE_CODE,
       B.PANEL_NO,
       B.PRODUCTION_DATE,
       B.QTY AS BARCODE_QTY,
       B.BARCODE,
       (SELECT MAX(LT.LOCATION_TASK_UUID)
          FROM LOCATION_TASK LT, STOCK_WORK SW, REMAIN_SINWORK RS
         WHERE LOD.LOGISTICS_ORDER_DETAIL_UUID = LT.LOGISTICS_ORDER_DETAIL_UUID
           AND LT.LOCATION_TASK_UUID = SW.LOCATION_TASK_UUID
           AND SW.STOCK_WORK_UUID = RS.IN_STOCK_WORK_UUID
           AND LT.LOC_TASK_TYPE = :locTaskType
           AND RS.BARCODE = :barcode
        ) AS LOC_TASK_UUID,
       (SELECT MAX(LT.TARGET_LOT_CODE)
          FROM LOCATION_TASK LT, STOCK_WORK SW, REMAIN_SINWORK RS
         WHERE LOD.LOGISTICS_ORDER_DETAIL_UUID = LT.LOGISTICS_ORDER_DETAIL_UUID
           AND LT.LOCATION_TASK_UUID = SW.LOCATION_TASK_UUID
           AND SW.STOCK_WORK_UUID = RS.IN_STOCK_WORK_UUID
           AND LT.LOC_TASK_TYPE = :locTaskType
           AND RS.BARCODE = :barcode
          ) AS LT_TARGET_LOT_CODE,
       (SELECT IFNULL(SUM(LT.QTY),0)
          FROM LOCATION_TASK LT, STOCK_WORK SW, REMAIN_SINWORK RS
         WHERE LOD.LOGISTICS_ORDER_DETAIL_UUID = LT.LOGISTICS_ORDER_DETAIL_UUID
           AND LT.LOCATION_TASK_UUID = SW.LOCATION_TASK_UUID
           AND SW.STOCK_WORK_UUID = RS.IN_STOCK_WORK_UUID
           AND LT.LOC_TASK_TYPE = :locTaskType
           AND RS.BARCODE = :barcode) AS LT_QTY,
       (SELECT MAX(LT.LOC_TASK_DATE)
          FROM LOCATION_TASK LT, STOCK_WORK SW, REMAIN_SINWORK RS
         WHERE LOD.LOGISTICS_ORDER_DETAIL_UUID = LT.LOGISTICS_ORDER_DETAIL_UUID
           AND LT.LOCATION_TASK_UUID = SW.LOCATION_TASK_UUID
           AND SW.STOCK_WORK_UUID = RS.IN_STOCK_WORK_UUID
           AND LT.LOC_TASK_TYPE = :locTaskType
           AND RS.BARCODE = :barcode
           ) AS LOC_TASK_DATE,
        (SELECT MAX(LT.EXT_ITEM_CODE)
          FROM LOCATION_TASK LT, STOCK_WORK SW, REMAIN_SINWORK RS
         WHERE LOD.LOGISTICS_ORDER_DETAIL_UUID = LT.LOGISTICS_ORDER_DETAIL_UUID
           AND LT.LOCATION_TASK_UUID = SW.LOCATION_TASK_UUID
           AND SW.STOCK_WORK_UUID = RS.IN_STOCK_WORK_UUID
           AND LT.LOC_TASK_TYPE = :locTaskType
           AND RS.BARCODE = :barcode
           ) AS LT_EXT_ITEM_CODE,
         (SELECT MAX(LT.GROSS_WEIGHT)
          FROM LOCATION_TASK LT, STOCK_WORK SW, REMAIN_SINWORK RS
         WHERE LOD.LOGISTICS_ORDER_DETAIL_UUID = LT.LOGISTICS_ORDER_DETAIL_UUID
           AND LT.LOCATION_TASK_UUID = SW.LOCATION_TASK_UUID
           AND SW.STOCK_WORK_UUID = RS.IN_STOCK_WORK_UUID
           AND LT.LOC_TASK_TYPE = :locTaskType
           AND RS.BARCODE = :barcode
           ) AS LT_GROSS_WEIGHT,
         (SELECT MAX(LT.LENGTH)
          FROM LOCATION_TASK LT, STOCK_WORK SW, REMAIN_SINWORK RS
         WHERE LOD.LOGISTICS_ORDER_DETAIL_UUID = LT.LOGISTICS_ORDER_DETAIL_UUID
           AND LT.LOCATION_TASK_UUID = SW.LOCATION_TASK_UUID
           AND SW.STOCK_WORK_UUID = RS.IN_STOCK_WORK_UUID
           AND LT.LOC_TASK_TYPE = :locTaskType
           AND RS.BARCODE = :barcode
           ) AS LT_LENGTH,
           (SELECT MAX(LT.WIDTH)
          FROM LOCATION_TASK LT, STOCK_WORK SW, REMAIN_SINWORK RS
         WHERE LOD.LOGISTICS_ORDER_DETAIL_UUID = LT.LOGISTICS_ORDER_DETAIL_UUID
           AND LT.LOCATION_TASK_UUID = SW.LOCATION_TASK_UUID
           AND SW.STOCK_WORK_UUID = RS.IN_STOCK_WORK_UUID
           AND LT.LOC_TASK_TYPE = :locTaskType
           AND RS.BARCODE = :barcode
           ) AS LT_WIDTH,
           (SELECT MAX(LT.HEIGHT)
          FROM LOCATION_TASK LT, STOCK_WORK SW, REMAIN_SINWORK RS
         WHERE LOD.LOGISTICS_ORDER_DETAIL_UUID = LT.LOGISTICS_ORDER_DETAIL_UUID
           AND LT.LOCATION_TASK_UUID = SW.LOCATION_TASK_UUID
           AND SW.STOCK_WORK_UUID = RS.IN_STOCK_WORK_UUID
           AND LT.LOC_TASK_TYPE = :locTaskType
           AND RS.BARCODE = :barcode
            ) AS LT_HEIGHT,
           (SELECT MAX(LT.VOLUME)
          FROM LOCATION_TASK LT, STOCK_WORK SW, REMAIN_SINWORK RS
         WHERE LOD.LOGISTICS_ORDER_DETAIL_UUID = LT.LOGISTICS_ORDER_DETAIL_UUID
           AND LT.LOCATION_TASK_UUID = SW.LOCATION_TASK_UUID
           AND SW.STOCK_WORK_UUID = RS.IN_STOCK_WORK_UUID
           AND LT.LOC_TASK_TYPE = :locTaskType
           AND RS.BARCODE = :barcode
           ) AS LT_VOLUME,
         (SELECT MAX(LT.PACKAGE_TYPE)
          FROM LOCATION_TASK LT, STOCK_WORK SW, REMAIN_SINWORK RS
         WHERE LOD.LOGISTICS_ORDER_DETAIL_UUID = LT.LOGISTICS_ORDER_DETAIL_UUID
           AND LT.LOCATION_TASK_UUID = SW.LOCATION_TASK_UUID
           AND SW.STOCK_WORK_UUID = RS.IN_STOCK_WORK_UUID
           AND LT.LOC_TASK_TYPE = :locTaskType
           AND RS.BARCODE = :barcode
          ) AS LT_PACKAGE_TYPE,
         (SELECT IFNULL(MAX(RS.REMAIN_SECOND_QTY), 0)
          FROM LOCATION_TASK LT, STOCK_WORK SW, REMAIN_SINWORK RS
         WHERE LOD.LOGISTICS_ORDER_DETAIL_UUID = LT.LOGISTICS_ORDER_DETAIL_UUID
           AND LT.LOCATION_TASK_UUID = SW.LOCATION_TASK_UUID
           AND SW.STOCK_WORK_UUID = RS.IN_STOCK_WORK_UUID
           AND LT.LOC_TASK_TYPE = :locTaskType
           AND RS.BARCODE = :barcode
            ) AS REMAIN_SECOND_QTY,
          (SELECT MAX(RS.GOODS_NATURE)
          FROM LOCATION_TASK LT, STOCK_WORK SW, REMAIN_SINWORK RS
         WHERE LOD.LOGISTICS_ORDER_DETAIL_UUID = LT.LOGISTICS_ORDER_DETAIL_UUID
           AND LT.LOCATION_TASK_UUID = SW.LOCATION_TASK_UUID
           AND SW.STOCK_WORK_UUID = RS.IN_STOCK_WORK_UUID
           AND LT.LOC_TASK_TYPE = :locTaskType
           AND RS.BARCODE = :barcode
           ) AS LT_GOODS_NATURE 
  FROM LOGISTICS_ORDER_DETAIL LOD, LOGISTICS_ORDER LO, BARCODE B
 WHERE LO.LOGISTICS_ORDER_UUID = LOD.LOGISTICS_ORDER_UUID
   AND LOD.LOGISTICS_ORDER_DETAIL_UUID = B.LOGISTICS_ORDER_DETAIL_UUID
   AND LO.TRANSACTION_STATUS = :transactionStatus
   AND LO.TRANSACTION_TYPE = :transactionType
   AND B.STATUS = :transactionStatus
   <<AND B.BARCODE = :barcode>>
   <<AND B.BARCODE = :barcode>>
   <<AND LOD.BATCH_NO = :batchNo>>
   AND (LOD.LOGISTICS_ORDER_NO = :orderNo OR LO.ORDER_NO = :orderNo)
   AND LO.OFFICE_CODE = :officeCode
   and ##CONDITIONS##

		]]>
	</sql-query>
</hibernate-mapping>
