<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC 
	"-//Hibernate/Hibernate Mapping DTD 3.0//EN"
	"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping>
	<sql-query name="KgCpReceQuery">
		<![CDATA[

SELECT LOL.AUX1 AS BATCH_NO,

       (SELECT SUM(LOD.CONFIRMED_QTY) FROM LOGISTICS_ORDER_DETAIL LOD WHERE LOD.LOGISTICS_ORDER_UUID = LO.LOGISTICS_ORDER_UUID
       AND LOD.BATCH_NO = LOL.AUX1) AS CONFIRMED_QTY ,
       
       (SELECT COUNT('X')
          FROM LOGISTICS_ORDER_LOG LOLD
         WHERE LOLD.LOGISTICS_ORDER_UUID = LO.LOGISTICS_ORDER_UUID
           AND LOLD.OFFICE_CODE = LO.OFFICE_CODE
           AND LOLD.TRANSACTION_TYPE = 'BARCODE_FAIL'
           AND LOLD.AUX1 = LOL.AUX1) AS FAIL_QTY,
           
       (SELECT COUNT('X')
          FROM LOGISTICS_ORDER_LOG LOLD
         WHERE LOLD.LOGISTICS_ORDER_UUID = LO.LOGISTICS_ORDER_UUID
           AND LOLD.OFFICE_CODE = LO.OFFICE_CODE
           AND LOLD.TRANSACTION_TYPE = 'BARCODE_PASS'
           AND LOLD.AUX1 =  LOL.AUX1) AS PASS_QTY 
  
 FROM LOGISTICS_ORDER_LOG LOL, LOGISTICS_ORDER LO
 WHERE LOL.LOGISTICS_ORDER_UUID = LO.LOGISTICS_ORDER_UUID
   AND LO.ORDER_NO = :orderNo
   AND LO.OFFICE_CODE = :officeCode
   AND LOL.OFFICE_CODE = :officeCode
   AND LO.TRANSACTION_STATUS = 'Active'
   AND LO.TRANSACTION_TYPE = 'SIN'
   AND LO.DELIVERY_TYPE = '成品入库'  
   GROUP BY LOL.AUX1,LO.LOGISTICS_ORDER_UUID,LO.OFFICE_CODE
		]]>
	</sql-query>
</hibernate-mapping>
